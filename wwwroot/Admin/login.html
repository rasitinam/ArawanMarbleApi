<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Login Page - ArawanPanel</title>
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600">
    <!-- https://fonts.google.com/specimen/Open+Sans -->
    <link rel="stylesheet" href="css/fontawesome.min.css">
    <!-- https://fontawesome.com/ -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- https://getbootstrap.com/ -->
    <link rel="stylesheet" href="css/tooplate.css">
</head>

<body class="bg03">
    <div class="container">
        <div class="row tm-mt-big">
            <div class="col-12 mx-auto tm-login-col">
                <div class="bg-white tm-block">
                    <div class="row">
                        <div class="col-12 text-center">
                            <i class="fas fa-3x fa-tachometer-alt tm-site-icon text-center"></i>
                            <h2 class="tm-block-title mt-3">Login</h2>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-12">
                            <form action="index.html" method="post" class="tm-login-form">
                                <div class="input-group">
                                    <label for="username" class="col-xl-4 col-lg-4 col-md-4 col-sm-5 col-form-label">Username</label>
                                    <input name="username" type="text" class="form-control validate col-xl-9 col-lg-8 col-md-8 col-sm-7" id="username" value="" required>
                                </div>
                                <div class="input-group mt-3">
                                    <label for="password" class="col-xl-4 col-lg-4 col-md-4 col-sm-5 col-form-label">Password</label>
                                    <input name="password" type="password" class="form-control validate" id="password" value="" required>
                                </div>
                                <div class="input-group mt-3">
                                    <button type="submit" class="btn btn-primary d-inline-block mx-auto">Login</button>
                                </div>
                                <div class="input-group mt-3">
                                    <p><em>Just put a character to login.</em></p>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="row tm-mt-big">
            <div class="col-12 font-weight-light text-center">
                <p class="d-inline-block tm-bg-black text-white py-2 px-4">
                    Copyright &copy; 2025 Admin Dashboard . Created by
                    <a rel="nofollow" href="https://www.linkedin.com/in/meriç-orhay-a1a9b016a/" class="text-white tm-footer-link">Meriç Orhay</a> &
                    <a rel="nofollow" href="https://www.linkedin.com/in/raşit-inam-05a128298/" class="text-white tm-footer-link">Raşit İnam</a>
                </p>
            </div>
        </footer>
    </div>
    <script>
        // Diğer API isteklerinde Authorization header'ına token'ı ekle:
        fetch('/api/protectedResource', {
            method: 'GET',
            headers: {
                'Authorization': 'Bearer ' + localStorage.getItem('jwtToken')
            }
        })
            .then(response => response.json())
            .then(data => {
                console.log(data);
            })
            .catch(error => {
                console.error('API request failed:', error);
            });
    </script>
    <script>
        // Form gönderilmeden önce çalışacak olan kod:
        document.querySelector('.tm-login-form').addEventListener('submit', function (e) {
            e.preventDefault(); // Formun sayfayı yeniden yüklemesini engelle

            // Kullanıcı adı ve şifreyi formdan al
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            // API'ye POST isteği gönder
            fetch('/api/auth/login', {
                method: 'POST',
                body: JSON.stringify({
                    username: username,
                    password: password
                }),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.token) {
                        // Token alındığında localStorage'a kaydet
                        localStorage.setItem('jwtToken', data.token);
                        // Kullanıcıyı admin paneline yönlendir
                        window.location.href = '/Admin/index.html';
                    } else {
                        alert('Giriş başarısız, lütfen tekrar deneyin.');
                    }
                })
                .catch(error => {
                    console.error('Login failed:', error);
                    alert('Giriş sırasında bir hata oluştu.');
                });
        });
    </script>

</body>
</html>
